on:
    push:
      branches:
        - main
    pull_request:
      branches:
        - main

name: Render and Publish

permissions:
    contents: write
    pages: write

jobs:
    codespell:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v4
        - uses: codespell-project/actions-codespell@master

    build-deploy:
        runs-on: ubuntu-latest
        steps:
            - name: Check out repository
              uses: actions/checkout@v4
            - name: Install SSL
              uses: awalsh128/cache-apt-pkgs-action@latest
              with:
                packages: libssl-dev
            - name: Set up R
              uses: r-lib/actions/setup-r@v2
              with:
                r-version: '4.1.0'
                pandoc-version: '2.14'

            - name: Install dependencies
              run: |
                    install.packages(c("pagedown", "posterdown"))
              shell: Rscript {0}

            - name: Build the poster
              run: |
                    pagedown::chrome_print('poster.Rmd')
              shell: Rscript {0}

            - name: Move the html poster
              run: |
                    mkdir website
                    mv poster.html website/index.html

            - name: Commit poster PDF
              uses: EndBug/add-and-commit@v9
              with:
                add: 'poster.pdf'
                author_name: 'GitHub Actions'
                message: 'Add poster.pdf at ${{ github.sha }}'

            - name: Deploy html to gh-pages
              uses: JamesIves/github-pages-deploy-action@4.1.5
              with:
                branch: gh-pages
                folder: ${{github.workspace}}/website
